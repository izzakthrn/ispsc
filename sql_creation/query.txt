CREATE TABLE IF NOT EXISTS users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    firstname VARCHAR(100) NOT NULL,
    lastname VARCHAR(100) NOT NULL,
    student_id VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(255) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    is_verified TINYINT(1) DEFAULT 0,
    otp VARCHAR(6),
    otp_expiry DATETIME,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
(create a table for admin to:

1. register staff
2. live queue display and current windows assessment
3. able to view analytics refer to the queue table, make sure they are done and sorted based on date.
Should be able to view analytics into a graph.
4. able to view history
5. able to view the review in a pie visualization, 3 categories for 
neutral, positive and negative.
6. For user-view, when the staff is not logged in yet then the available window in the dashboard/user
should disappear and only appear when the staff is logged in into their respective window.

)
-- Staff Table (Will serve as a log in for the staff to control the windows)
CREATE TABLE IF NOT EXISTS staff (
    id INT AUTO_INCREMENT PRIMARY KEY,
    registrar_code VARCHAR(50) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL
);

-- Windows/Service Counters
CREATE TABLE IF NOT EXISTS windows (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Services Table
CREATE TABLE IF NOT EXISTS services (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    is_enabled TINYINT(1) DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO `services` (`id`, `name`, `description`, `is_enabled`) VALUES 
    (NULL, 'REQUEST FOR GRADES', 'STUDENT ID\r\nCASHIER RECEIPT', 1);

-- Window Services Mapping (which services are available at which windows)
CREATE TABLE IF NOT EXISTS window_services (
    id INT AUTO_INCREMENT PRIMARY KEY,
    window_id INT NOT NULL,
    service_id INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (window_id) REFERENCES windows(id) ON DELETE CASCADE,
    FOREIGN KEY (service_id) REFERENCES services(id) ON DELETE CASCADE,
    UNIQUE KEY (window_id, service_id)
);

-- Toggle Services Table (per-window service enable/disable)
CREATE TABLE IF NOT EXISTS toggle_services (
    id INT AUTO_INCREMENT PRIMARY KEY,
    window_id INT NOT NULL,
    service_id INT NOT NULL,
    is_enabled TINYINT(1) DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (window_id) REFERENCES windows(id) ON DELETE CASCADE,
    FOREIGN KEY (service_id) REFERENCES services(id) ON DELETE CASCADE,
    UNIQUE KEY (window_id, service_id)
);

-- Queue Table (combines waiting and being served)
CREATE TABLE IF NOT EXISTS queue (
    id INT AUTO_INCREMENT PRIMARY KEY,
    queue_number VARCHAR(10) NOT NULL,
    customer_name VARCHAR(100) NOT NULL,
    email VARCHAR(255),
    service_id INT NOT NULL,
    window_id INT,
    status ENUM('waiting', 'serving', 'done') DEFAULT 'waiting',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    called_at TIMESTAMP NULL,
    completed_at TIMESTAMP NULL,
    FOREIGN KEY (service_id) REFERENCES services(id),
    FOREIGN KEY (window_id) REFERENCES windows(id) ON DELETE SET NULL
);

-- Review/Feedback Table
CREATE TABLE IF NOT EXISTS review (
    id INT AUTO_INCREMENT PRIMARY KEY,
    queue_id INT NOT NULL,
    score INT CHECK (score BETWEEN 1 AND 5),
    registrar_code VARCHAR(50),
    comments TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (queue_id) REFERENCES queue(id) ON DELETE CASCADE,
    FOREIGN KEY (registrar_code) REFERENCES staff(registrar_code)
);